# golangci-lint configuration
# See https://golangci-lint.run/usage/configuration/

run:
  timeout: 5m
  modules-download-mode: readonly
  allow-parallel-runners: true

output:
  format: colored-line-number
  print-issued-lines: true
  print-linter-name: true

linters:
  enable:
    # Default linters
    - errcheck
    - gosimple
    - govet
    - ineffassign
    - staticcheck
    - typecheck
    - unused
    
    # Additional linters
    - asciicheck
    - bodyclose
    - cyclop
    - dupl
    - durationcheck
    - errorlint
    - exhaustive
    - exportloopref
    - forbidigo
    - forcetypeassert
    - gci
    - gochecknoinits
    - gocognit
    - goconst
    - gocritic
    - gocyclo
    - godot
    - gofmt
    - gofumpt
    - goheader
    - goimports
    - gomnd
    - gomoddirectives
    - gomodguard
    - goprintffuncname
    - gosec
    - grouper
    - importas
    - lll
    - makezero
    - misspell
    - nakedret
    - nestif
    - nilerr
    - nilnil
    - noctx
    - nolintlint
    - prealloc
    - predeclared
    - promlinter
    - revive
    - rowserrcheck
    - sqlclosecheck
    - stylecheck
    - tenv
    - testpackage
    - thelper
    - tparallel
    - unconvert
    - unparam
    - wastedassign
    - whitespace
    - wrapcheck

linters-settings:
  cyclop:
    max-complexity: 15
    
  dupl:
    threshold: 100
    
  errorlint:
    errorf: true
    asserts: true
    comparison: true
    
  exhaustive:
    check-generated: false
    default-signifies-exhaustive: false
    
  forbidigo:
    forbid:
      - ^print.*$
      - 'fmt\.Print.*'
      
  gci:
    sections:
      - standard
      - default
      - prefix(github.com/marguerr/multi-network-policy-nftables)
    skip-generated: true
    
  gocognit:
    min-complexity: 15
    
  goconst:
    min-len: 2
    min-occurrences: 3
    
  gocritic:
    enabled-tags:
      - diagnostic
      - experimental
      - opinionated
      - performance
      - style
    disabled-checks:
      - dupImport
      - ifElseChain
      - octalLiteral
      - whyNoLint
      
  gocyclo:
    min-complexity: 15
    
  godot:
    scope: declarations
    exclude:
      - "^ *@"
      - "^ *TODO"
      - "^ *FIXME"
      
  gofumpt:
    extra-rules: true
    
  goheader:
    template: |-
      Copyright {{ YEAR }} The Multi-Network Policy NFTables Authors.
      
      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at
      
          http://www.apache.org/licenses/LICENSE-2.0
      
      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
      
  goimports:
    local-prefixes: github.com/marguerr/multi-network-policy-nftables
    
  gomnd:
    checks:
      - argument
      - case
      - condition
      - operation
      - return
    ignored-numbers:
      - '0'
      - '1'
      - '2'
      - '3'
      - '10'
      - '100'
      - '1000'
      
  gosec:
    severity: medium
    confidence: medium
    excludes:
      - G204 # Subprocess launched with variable
      - G304 # File path provided as taint input
      
  lll:
    line-length: 120
    
  misspell:
    locale: US
    
  nakedret:
    max-func-lines: 30
    
  nestif:
    min-complexity: 4
    
  nolintlint:
    allow-leading-space: true
    allow-unused: false
    require-explanation: false
    require-specific: false
    
  prealloc:
    simple: true
    range-loops: true
    for-loops: false
    
  revive:
    rules:
      - name: exported
        arguments:
          - "checkPrivateReceivers"
          - "sayRepetitiveInsteadOfStutters"
      - name: package-comments
      - name: var-naming
      - name: context-as-argument
      - name: dot-imports
      - name: blank-imports
      - name: exported
      - name: var-declaration
      - name: package-comments
      - name: increment-decrement
      - name: error-return
      - name: error-naming
      - name: receiver-naming
      - name: indent-error-flow
      
  stylecheck:
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]
    
  testpackage:
    skip-regexp: '(export|internal)_test\.go'
    
  unparam:
    check-exported: false
    
  wrapcheck:
    ignoreSigs:
      - .Errorf(
      - errors.New(
      - errors.Unwrap(
      - .Wrap(
      - .Wrapf(

issues:
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gomnd
        - goconst
        - dupl
        - lll
        - gocritic
        - cyclop
        - gocognit
        - funlen
        - wrapcheck
        
    # Exclude some linters from running on generated files
    - path: ".*\\.pb\\.go"
      linters:
        - lll
        - gocritic
        - gocyclo
        - cyclop
        - dupl
        - gosec
        
    # Exclude some linters from running on main.go
    - path: cmd/main\.go
      linters:
        - gochecknoinits
        
  exclude:
    # errcheck: Almost all programs ignore errors on these functions
    - Error return value of .((os\.)?std(out|err)\..*|.*Close|.*Flush|os\.Remove(All)?|.*printf?|os\.(Un)?Setenv). is not checked
    
    # govet: Common false positives
    - (possible misuse of unsafe.Pointer|should have signature)
    
    # staticcheck: Developers tend to write in C-style with an explicit 'break' in a 'switch'
    - ineffective break statement. Did you mean to break out of the outer loop
    
    # gosec: Too many false-positives on 'unsafe' usage
    - G103
    
    # gosec: Too many false-positives for parametrized shell calls
    - G204
    
    # gosec: Duplicated errcheck checks
    - G104
    
  max-issues-per-linter: 0
  max-same-issues: 0
